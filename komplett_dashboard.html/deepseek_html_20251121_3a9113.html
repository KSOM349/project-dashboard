<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Chaos Engineering Dashboard - REALTIME</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Alla dina befintliga styles f칬rblir of칬r칛ndrade */
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #1e40af;
            --bg-light: #ffffff;
            --bg-dark: #0f172a;
            --text-light: #1e293b;
            --text-dark: #f8fafc;
            --sidebar-light: #f8fafc;
            --sidebar-dark: #1e293b;
            --card-light: #ffffff;
            --card-dark: #334155;
        }

        .theme-transition {
            transition: all 0.3s ease;
        }

        [data-theme="light"] {
            --bg-color: var(--bg-light);
            --text-color: var(--text-light);
            --sidebar-bg: var(--sidebar-light);
            --card-bg: var(--card-light);
        }

        [data-theme="dark"] {
            --bg-color: var(--bg-dark);
            --text-color: var(--text-dark);
            --sidebar-bg: var(--sidebar-dark);
            --card-bg: var(--card-dark);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .sidebar {
            background-color: var(--sidebar-bg);
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid;
            border-color: var(--border-color);
        }

        .active-section {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
        }

        .gradient-header {
            background: linear-gradient(135deg, #2563eb, #1e40af);
        }

        .add-content-modal, .team-chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .add-content-modal.active, .team-chat-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 游 FIXED CHAT STYLES */
        .team-chat-modal {
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .team-chat-modal > div {
            max-height: 90vh;
            height: auto;
        }

        @media (max-width: 768px) {
            .team-chat-modal > div {
                height: 90vh;
            }
        }

        .chat-input-container {
            min-height: 60px;
        }

        .chat-messages-container {
            max-height: 400px;
            min-height: 300px;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #10B981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .realtime-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-left: 4px solid #3B82F6;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            animation: slideInRight 0.5s ease;
            min-width: 300px;
            border: 2px solid #3B82F6;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .chat-message {
            margin: 8px 0;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            word-break: break-word;
        }

        .chat-message.own {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .chat-message.other {
            background: #F3F4F6;
            color: #1F2937;
            border-bottom-left-radius: 4px;
        }

        .live-activity-item {
            padding: 12px;
            margin: 8px 0;
            background: #F0F9FF;
            border-left: 4px solid #3B82F6;
            border-radius: 8px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .live-user-badge {
            display: inline-flex;
            align-items: center;
            background: #DCFCE7;
            color: #166534;
            padding: 6px 12px;
            border-radius: 20px;
            margin: 4px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .realtime-badge {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
    </style>
</head>
<body class="theme-transition" data-theme="light">
    <!-- Dina befintliga modaler och layout... -->

    <!-- 游 UPPDATERAD Team Chat Modal med b칛ttre layout -->
    <div class="team-chat-modal" id="teamChatModal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl w-full mx-4 shadow-2xl max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                    <span class="realtime-badge">
                        <span class="online-indicator"></span>
                        SIMULERAD CHAT
                    </span>
                    Team Chat
                </h2>
                <button onclick="closeTeamChat()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- Info Banner - F칬rklarar hur chatten fungerar -->
            <div class="mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-700">
                <div class="flex items-center gap-3">
                    <i class="fas fa-info-circle text-yellow-600 dark:text-yellow-400 text-xl"></i>
                    <div>
                        <div class="font-semibold text-yellow-800 dark:text-yellow-200">Simulerad Chat</div>
                        <div class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                            Denna chat 칛r f칬r demonstration. Meddelanden skickas inte till riktiga anv칛ndare. 
                            Systemet simulerar svar fr친n teammedlemmar efter 2 sekunder.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Online Users -->
            <div class="mb-4 p-4 bg-gradient-to-r from-green-50 to-blue-50 dark:from-gray-700 dark:to-gray-600 rounded-lg border border-green-200 dark:border-green-800">
                <h3 class="font-semibold mb-3 text-gray-800 dark:text-white flex items-center gap-2">
                    <span class="online-indicator"></span>
                    Online Now (Simulerade)
                </h3>
                <div id="onlineUsersList" class="flex flex-wrap gap-2">
                    <div class="live-user-badge">
                        <span class="online-indicator"></span>
                        You
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" class="chat-messages-container overflow-y-auto mb-4 space-y-3 p-4 border-2 border-blue-200 dark:border-blue-800 rounded-lg bg-gray-50 dark:bg-gray-900">
                <div class="text-center text-gray-500 dark:text-gray-400 text-sm py-8">
                    <i class="fas fa-comments text-2xl mb-2 block"></i>
                    Start chatting with your team! Messages will get simulated responses.
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container flex gap-2 items-end">
                <input type="text" id="chatInput" placeholder="Type your message..." 
                       class="flex-1 p-4 border-2 border-blue-300 dark:border-blue-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white text-lg"
                       onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button onclick="sendChatMessage()" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-4 rounded-xl transition-all shadow-lg h-fit">
                    <i class="fas fa-paper-plane text-lg"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Resten av din befintliga kod... -->

    <script>
        // 游 F칐RB츿TTRAD REALTIME SYSTEM med b칛ttre f칬rklaringar
        class SimpleRealtimeSystem {
            constructor() {
                this.connectedUsers = new Map();
                this.currentUser = { id: '1', name: 'You', role: 'Team Member' };
                this.isConnected = true;
                this.chatHistory = [];
                
                console.log('游눫 CHAT SYSTEM: Simulerad chat - inga riktiga meddelanden skickas');
                this.connect();
            }

            connect() {
                this.isConnected = true;
                this.addDemoUsers();
                this.startDemoActivities();
                
                console.log('游댕 REALTIME SYSTEM: Ansluten - All aktivitet 칛r simulerad');
            }

            addDemoUsers() {
                const demoUsers = [
                    { id: '2', name: 'Kaled Osman', role: 'Developer' },
                    { id: '3', name: 'Fahad Hussain', role: 'Researcher' },
                    { id: '4', name: 'Stefan 칐sterberg', role: 'Architect' },
                    { id: '5', name: 'Marcus Tibell', role: 'Engineer' }
                ];

                const onlineList = document.getElementById('onlineUsersList');
                const liveTeamList = document.getElementById('liveTeamList');
                
                this.addUserToLists(this.currentUser, onlineList, liveTeamList);
                
                demoUsers.forEach((user, index) => {
                    setTimeout(() => {
                        this.addUserToLists(user, onlineList, liveTeamList);
                        this.showRealtimeNotification(`游님 ${user.name} gick med i dashboarden (simulerad)`);
                        this.addActivity(`${user.name} gick med i team session`);
                    }, (index + 1) * 1500);
                });
            }

            addUserToLists(user, onlineList, liveTeamList) {
                this.connectedUsers.set(user.id, user);
                
                if (onlineList) {
                    const userBadge = document.createElement('div');
                    userBadge.className = 'live-user-badge';
                    userBadge.innerHTML = `
                        <span class="online-indicator"></span>
                        ${user.name}
                    `;
                    onlineList.appendChild(userBadge);
                }

                if (liveTeamList) {
                    const userElement = document.createElement('div');
                    userElement.className = 'flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-green-200 dark:border-green-800';
                    userElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <span class="online-indicator"></span>
                            <div>
                                <div class="font-semibold text-gray-800 dark:text-white">${user.name}</div>
                                <div class="text-xs text-gray-500">${user.role}</div>
                            </div>
                        </div>
                        <span class="text-xs text-green-600 font-semibold">Online</span>
                    `;
                    liveTeamList.appendChild(userElement);
                }
            }

            // 游 F칐RB츿TTRAD CHAT FUNKTION med tydligare simulering
            sendChatMessage(messageText) {
                if (!messageText.trim()) return;
                
                // Spara meddelande i historik
                this.chatHistory.push({
                    user: this.currentUser,
                    text: messageText,
                    timestamp: new Date(),
                    type: 'sent'
                });
                
                this.displayChatMessage(messageText, this.currentUser);
                
                // 游꿠 SIMULERA SVAR fr친n andra anv칛ndare
                this.simulateResponse(messageText);
            }

            simulateResponse(originalMessage) {
                const users = Array.from(this.connectedUsers.values());
                const randomUser = users.find(u => u.id !== this.currentUser.id);
                
                if (!randomUser) return;

                // V칛nta 1-3 sekunder f칬r mer realistiskt svar
                const delay = 1000 + Math.random() * 2000;
                
                setTimeout(() => {
                    const responses = this.generateResponse(originalMessage, randomUser);
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    // Spara simulerat svar i historik
                    this.chatHistory.push({
                        user: randomUser,
                        text: randomResponse,
                        timestamp: new Date(),
                        type: 'received'
                    });
                    
                    this.displayChatMessage(randomResponse, randomUser);
                    
                    // Visa notifikation om chatten inte 칛r 칬ppen
                    if (!document.getElementById('teamChatModal').classList.contains('active')) {
                        this.showRealtimeNotification(`游눫 ${randomUser.name}: ${randomResponse}`);
                    }
                }, delay);
            }

            generateResponse(originalMessage, user) {
                const message = originalMessage.toLowerCase();
                
                // Olika svar baserat p친 inneh친ll i meddelandet
                if (message.includes('?')) {
                    return [
                        "Bra fr친ga! Jag m친ste kolla upp det.",
                        "Jag tror jag vet svaret p친 det. L친t mig dubbelkolla.",
                        "Det 칛r en intressant fr친ga. Vad tror du sj칛lv?",
                        "Jag har funderat p친 det ocks친. Vi borde diskutera det p친 n칛sta m칬te."
                    ];
                } else if (message.includes('tack') || message.includes('thank')) {
                    return [
                        "Ingen orsak! Glad att kunna hj칛lpa.",
                        "Visst, det var s친 lite!",
                        "Alltid kul att samarbeta med dig!",
                        "Tack sj칛lv f칬r bra teamwork!"
                    ];
                } else if (message.includes('hej') || message.includes('hello') || message.includes('hi')) {
                    return [
                        "Hej! Kul att du 칛r h칛r!",
                        "Tjena! Hur g친r det?",
                        "Hejsan! Ska vi jobba p친 n친got speciellt idag?",
                        "Hall친! Bra timing, jag beh칬vde just prata med dig."
                    ];
                } else {
                    return [
                        "Intressant! Kan du ber칛tta mer?",
                        "Jag h친ller med dig d칛r.",
                        "Det l친ter som en bra id칠.",
                        "Jag ska titta p친 det direkt.",
                        "Bra po칛ng! Vi borde dokumentera det.",
                        "Perfekt timing - jag jobbade just med n친got liknande."
                    ];
                }
            }

            displayChatMessage(text, user) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;

                const messageElement = document.createElement('div');
                const isOwnMessage = user.id === this.currentUser.id;
                messageElement.className = `chat-message ${isOwnMessage ? 'own' : 'other'}`;
                messageElement.innerHTML = `
                    <div class="font-semibold ${isOwnMessage ? 'text-blue-100' : 'text-gray-800'}">${user.name}</div>
                    <div class="${isOwnMessage ? 'text-white' : 'text-gray-700'}">${text}</div>
                    <div class="text-xs ${isOwnMessage ? 'text-blue-200' : 'text-gray-500'} mt-1">${new Date().toLocaleTimeString()}</div>
                `;
                chatMessages.appendChild(messageElement);
                
                // Ta bort placeholder
                const placeholder = chatMessages.querySelector('.text-center');
                if (placeholder) placeholder.remove();
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            showRealtimeNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'realtime-notification';
                notification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="online-indicator"></span>
                        <div>
                            <div class="font-semibold text-gray-800">Team Activity</div>
                            <div class="text-sm text-gray-600">${message}</div>
                        </div>
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideInRight 0.5s ease reverse';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 500);
                }, 4000);
            }

            startDemoActivities() {
                // Simulera team aktiviteter
                setTimeout(() => this.simulateActivity('Kaled Osman', 'la till dokumentation i Project Documentation'), 3000);
                setTimeout(() => this.simulateActivity('Fahad Hussain', 'jobbar med algoritmf칬rb칛ttringar'), 6000);
                setTimeout(() => this.simulateActivity('Stefan 칐sterberg', 'uppdaterade teamuppgifter i Collaboration'), 9000);
                
                setInterval(() => {
                    const users = Array.from(this.connectedUsers.values());
                    const randomUser = users[Math.floor(Math.random() * users.length)];
                    const activities = [
                        'redigerar projekt dokumentation',
                        'la till nytt inneh친ll i dashboarden',
                        'granskar team uppdateringar',
                        'jobbar med praktiska uppgifter'
                    ];
                    const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                    
                    if (randomUser && randomUser.id !== this.currentUser.id) {
                        this.simulateActivity(randomUser.name, randomActivity);
                    }
                }, 15000);
            }

            simulateActivity(userName, activity) {
                this.addActivity(`${userName} ${activity}`);
                this.showRealtimeNotification(`${userName} ${activity}`);
            }

            addActivity(text) {
                const activityList = document.getElementById('activityList');
                const realtimeActivities = document.getElementById('realtimeActivities');
                
                if (activityList) {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'live-activity-item';
                    activityElement.innerHTML = `
                        <div class="flex items-center gap-2 mb-1">
                            <span class="online-indicator"></span>
                            <span class="font-semibold text-gray-800 dark:text-white">Team Activity</span>
                        </div>
                        <div class="text-gray-700 dark:text-gray-300">${text}</div>
                        <div class="text-xs text-gray-500 mt-1">${new Date().toLocaleTimeString()}</div>
                    `;
                    
                    const placeholder = activityList.querySelector('.text-center');
                    if (placeholder) placeholder.remove();
                    
                    activityList.insertBefore(activityElement, activityList.firstChild);
                    
                    if (activityList.children.length > 5) {
                        activityList.removeChild(activityList.lastChild);
                    }
                }
            }
        }

        // Initialize the realtime system
        const realtimeSystem = new SimpleRealtimeSystem();

        // 游 Team Chat Functions
        function openTeamChat() {
            document.getElementById('teamChatModal').classList.add('active');
        }

        function closeTeamChat() {
            document.getElementById('teamChatModal').classList.remove('active');
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                realtimeSystem.sendChatMessage(message);
                input.value = '';
            }
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
                e.preventDefault();
            }
        });

        // Resten av din befintliga kod...
    </script>
</body>
</html>
